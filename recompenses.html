<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>A-CadÃ©mie â€” RÃ©compenses</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/acad-style.css">

  <!-- Firebase (optionnel mais prÃªt pour lâ€™auth anonyme + Firestore) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="./js/firebase-config.js"></script>
</head>
<body>
  <div class="page">
    <header class="acad-header">
      <div class="brand">
        <div class="brand-logo">A</div>
        <div>
          <div class="brand-text-title">A-CadÃ©mie</div>
          <div class="brand-text-sub">Articles & quiz sportifs en libre accÃ¨s</div>
        </div>
      </div>

      <nav class="acad-nav">
        <a class="nav-btn" href="./index.html"><span class="dot"></span> Accueil</a>
        <a class="nav-btn" href="./articles.html">Articles</a>
        <a class="nav-btn primary" href="./recompenses.html">RÃ©compenses</a>
      </nav>

      <div id="acad-profile" class="profile-card">
        <div class="profile-main">
          <div class="profile-avatar">A</div>
          <div>
            <div class="profile-level">Niveau <span id="acad-level">1</span></div>
            <div class="profile-xp">
              <span id="acad-xp">0</span> XP locale
            </div>
          </div>
        </div>
        <div class="profile-progress-wrapper">
          <div class="profile-progress-bar">
            <div class="profile-progress-fill" id="acad-xp-bar"></div>
          </div>
          <div class="profile-progress-label">
            <span>Vers niveau <span id="acad-next-level">2</span></span>
            <span id="acad-xp-to-next">0 / 100</span>
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="card">
        <h1 class="section-title">Badges & rÃ©compenses</h1>
        <p class="section-subtitle">
          Ces badges se dÃ©bloquent automatiquement en fonction de ce que tu fais sur A-CadÃ©mie :
          articles lus, quiz complÃ©tÃ©s et progression dans les catÃ©gories.
        </p>

        <div class="badges-grid" id="badges-grid">
          <!-- Badge 1er article lu -->
          <div class="badge-card" id="badge_first_article">
            <div class="badge-title">Badge â€œ1er article luâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : lire au moins 1 article jusquâ€™au bout.
            </div>
            <div class="badge-progress" data-type="first-article"></div>
          </div>

          <!-- Badge 1er quiz rÃ©pondu -->
          <div class="badge-card" id="badge_first_quiz">
            <div class="badge-title">Badge â€œ1er quiz rÃ©ponduâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : terminer au moins 1 quiz (peu importe le score).
            </div>
            <div class="badge-progress" data-type="first-quiz"></div>
          </div>

          <!-- Badge 10 articles lus -->
          <div class="badge-card" id="badge_10_articles">
            <div class="badge-title">Badge â€œ10 articles lusâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : lire au moins 10 articles diffÃ©rents.
            </div>
            <div class="badge-progress" data-type="10-articles"></div>
          </div>

          <!-- Badge 10 quiz rÃ©pondus -->
          <div class="badge-card" id="badge_10_quiz">
            <div class="badge-title">Badge â€œ10 quiz rÃ©pondusâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : terminer au moins 10 quiz (peu importe le score).
            </div>
            <div class="badge-progress" data-type="10-quiz"></div>
          </div>

          <!-- Badge 10 articles dâ€™une mÃªme catÃ©gorie -->
          <div class="badge-card" id="badge_10_articles_cat">
            <div class="badge-title">Badge â€œSpÃ©cialiste â€“ 10 articles dans une mÃªme catÃ©gorieâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : lire au moins 10 articles appartenant Ã  la mÃªme catÃ©gorie (Endurance, HygiÃ¨ne de vie, etc.).
            </div>
            <div class="badge-progress" data-type="10-articles-cat"></div>
          </div>

          <!-- Badge 10 quiz dâ€™une mÃªme catÃ©gorie -->
          <div class="badge-card" id="badge_10_quiz_cat">
            <div class="badge-title">Badge â€œExpert â€“ 10 quiz dans une mÃªme catÃ©gorieâ€</div>
            <div class="badge-status locked">ğŸ”’ VerrouillÃ©</div>
            <div class="badge-tag">
              Condition : terminer au moins 10 quiz liÃ©s Ã  des articles dâ€™une mÃªme catÃ©gorie.
            </div>
            <div class="badge-progress" data-type="10-quiz-cat"></div>
          </div>
        </div>
      </section>

      <footer>
        <span>Â© A-CadÃ©mie â€” Ressources sportives en libre accÃ¨s.</span>
        <span>
          <a href="#">Mentions lÃ©gales</a> Â·
          <a href="#">ConfidentialitÃ©</a> Â·
          <a href="#">Contact</a>
        </span>
      </footer>
    </main>
  </div>

  <!-- Gamification locale + synchronisation Firebase -->
  <script src="./js/acad-gamification.js"></script>
  <script src="./js/acad-firebase-sync.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (!window.acadGamification) return;

      // RÃ©cupÃ©ration de l'Ã©tat de gamification (localStorage, Ã©ventuellement fusionnÃ© avec Firebase)
      const state = window.acadGamification.getState
        ? window.acadGamification.getState()
        : {
            xp: 0,
            level: 1,
            readArticles: [],
            completedQuizzes: [],
            perfectQuizzes: [],
            sharedArticles: []
          };

      const readArticles = state.readArticles || [];
      const completedQuizzes = state.completedQuizzes || [];

      const nbRead = readArticles.length;
      const nbQuiz = completedQuizzes.length;

      // Tableau de catÃ©gories par article
      // âœ Tu pourras complÃ©ter au fur et Ã  mesure que tu ajoutes des articles.
      const ARTICLE_CATEGORIES = {
        "vma": "endurance",
        "endurance-fondamentale": "endurance",
        "echauffement-5min": "mobilite"
        // ex: "debuter-course-pied": "endurance",
        //     "perte-de-poids-sans-regime": "hygiene",
        // etc.
      };

      function countByCategory(ids) {
        const counts = {};
        ids.forEach(function (id) {
          const cat = ARTICLE_CATEGORIES[id];
          if (!cat) return;
          counts[cat] = (counts[cat] || 0) + 1;
        });
        return counts;
      }

      const readByCat = countByCategory(readArticles);
      const quizByCat = countByCategory(completedQuizzes);

      const maxReadInCat = Object.values(readByCat).reduce((m, v) => Math.max(m, v), 0);
      const maxQuizInCat = Object.values(quizByCat).reduce((m, v) => Math.max(m, v), 0);

      const has10ReadSameCat = maxReadInCat >= 10;
      const has10QuizSameCat = maxQuizInCat >= 10;

      function updateBadge(badgeId, unlocked, progressText) {
        const card = document.getElementById(badgeId);
        if (!card) return;
        const statusEl = card.querySelector(".badge-status");
        const progressEl = card.querySelector(".badge-progress");

        if (unlocked) {
          if (statusEl) {
            statusEl.textContent = "âœ… DÃ©verrouillÃ©";
            statusEl.classList.remove("locked");
            statusEl.classList.add("unlocked");
          }
        } else {
          if (statusEl) {
            statusEl.textContent = "ğŸ”’ VerrouillÃ©";
            statusEl.classList.remove("unlocked");
            statusEl.classList.add("locked");
          }
        }

        if (progressEl && progressText) {
          progressEl.textContent = progressText;
        }
      }

      // 1er article lu (1 / 1)
      updateBadge(
        "badge_first_article",
        nbRead >= 1,
        nbRead + " / 1 article lu"
      );

      // 1er quiz rÃ©pondu (1 / 1)
      updateBadge(
        "badge_first_quiz",
        nbQuiz >= 1,
        nbQuiz + " / 1 quiz rÃ©pondu"
      );

      // 10 articles lus
      updateBadge(
        "badge_10_articles",
        nbRead >= 10,
        nbRead + " / 10 articles lus"
      );

      // 10 quiz rÃ©pondus
      updateBadge(
        "badge_10_quiz",
        nbQuiz >= 10,
        nbQuiz + " / 10 quiz rÃ©pondus"
      );

      // 10 articles dâ€™une mÃªme catÃ©gorie
      if (Object.keys(readByCat).length === 0) {
        updateBadge(
          "badge_10_articles_cat",
          false,
          "0 / 10 articles dans une mÃªme catÃ©gorie"
        );
      } else {
        const maxReadCatLabel = maxReadInCat + " article(s) sur la catÃ©gorie la plus lue";
        updateBadge(
          "badge_10_articles_cat",
          has10ReadSameCat,
          maxReadCatLabel + " (objectif : 10)"
        );
      }

      // 10 quiz dâ€™une mÃªme catÃ©gorie
      if (Object.keys(quizByCat).length === 0) {
        updateBadge(
          "badge_10_quiz_cat",
          false,
          "0 / 10 quiz dans une mÃªme catÃ©gorie"
        );
      } else {
        const maxQuizCatLabel = maxQuizInCat + " quiz sur la catÃ©gorie la plus travaillÃ©e";
        updateBadge(
          "badge_10_quiz_cat",
          has10QuizSameCat,
          maxQuizCatLabel + " (objectif : 10)"
        );
      }
    });
  </script>
</body>
</html>
